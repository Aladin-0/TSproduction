{% extends 'admin_panel/base.html' %}

{% block title %}Create User - TechVerse Admin{% endblock %}

{% block page_title %}Create New User{% endblock %}

{% block top_actions %}
<a href="{% url 'admin_panel:users' %}" class="btn btn-secondary">
    <i class="fas fa-arrow-left"></i>
    Back to Users
</a>
<button form="userForm" type="submit" class="btn btn-primary">
    <i class="fas fa-save"></i>
    Create User
</button>
{% endblock %}

{% block content %}
<div style="max-width: 800px;">
    <form id="userForm" method="post">
        {% csrf_token %}
        
        <div class="table-container" style="margin-bottom: 30px;">
            <div class="table-header">
                <h3 class="table-title">User Information</h3>
            </div>
            <div style="padding: 30px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" name="name" class="form-control" placeholder="Enter full name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email Address *</label>
                        <input type="email" name="email" class="form-control" placeholder="Enter email address" required>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" name="phone" class="form-control" placeholder="Enter phone number">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Role *</label>
                        <select name="role" class="form-control" required>
                            <option value="">Select Role</option>
                            <option value="CUSTOMER">Customer</option>
                            <option value="TECHNICIAN">Technician</option>
                            <option value="AMC">AMC Customer</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" name="password1" class="form-control" placeholder="Enter password" required>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 5px;">
                            Minimum 8 characters
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirm Password *</label>
                        <input type="password" name="password2" class="form-control" placeholder="Confirm password" required>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-container" style="margin-bottom: 30px;">
            <div class="table-header">
                <h3 class="table-title">Preferences</h3>
            </div>
            <div style="padding: 30px;">
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" name="email_notifications" value="true" checked style="width: 18px; height: 18px;">
                            <span>Email Notifications</span>
                        </label>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 5px;">
                            User will receive order updates and service notifications via email
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" name="sms_notifications" value="true" checked style="width: 18px; height: 18px;">
                            <span>SMS Notifications</span>
                        </label>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 5px;">
                            User will receive important updates via SMS
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" name="is_active" value="true" checked style="width: 18px; height: 18px;">
                            <span>Account Active</span>
                        </label>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 5px;">
                            Active users can log in and use the system
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="display: flex; gap: 15px; justify-content: end;">
            <a href="{% url 'admin_panel:users' %}" class="btn btn-secondary">
                <i class="fas fa-times"></i>
                Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Create User
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Form validation
    document.getElementById('userForm').addEventListener('submit', function(e) {
        const password1 = document.querySelector('input[name="password1"]').value;
        const password2 = document.querySelector('input[name="password2"]').value;
        
        if (password1 !== password2) {
            e.preventDefault();
            alert('Passwords do not match');
            return;
        }
        
        if (password1.length < 8) {
            e.preventDefault();
            alert('Password must be at least 8 characters long');
            return;
        }
    });

    // Email validation
    document.querySelector('input[name="email"]').addEventListener('blur', function() {
        const email = this.value;
        if (email) {
            // Basic email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                this.style.borderColor = '#ef4444';
                this.nextElementSibling?.remove(); // Remove existing error
                const error = document.createElement('div');
                error.style.cssText = 'font-size: 12px; color: #ef4444; margin-top: 5px;';
                error.textContent = 'Please enter a valid email address';
                this.parentNode.appendChild(error);
            } else {
                this.style.borderColor = '';
                this.nextElementSibling?.remove();
            }
        }
    });

    // Phone number formatting
    document.querySelector('input[name="phone"]').addEventListener('input', function() {
        let value = this.value.replace(/\D/g, '');
        if (value.length > 10) value = value.substr(0, 10);
        this.value = value;
    });

    // Role-specific information
    document.querySelector('select[name="role"]').addEventListener('change', function() {
        const roleInfo = document.getElementById('roleInfo');
        if (roleInfo) roleInfo.remove();
        
        if (this.value) {
            const info = document.createElement('div');
            info.id = 'roleInfo';
            info.style.cssText = 'margin-top: 10px; padding: 10px; background: rgba(96, 165, 250, 0.1); border-radius: 6px; font-size: 12px; color: #60a5fa;';
            
            switch(this.value) {
                case 'CUSTOMER':
                    info.textContent = 'Regular customers can place orders and request services';
                    break;
                case 'TECHNICIAN':
                    info.textContent = 'Technicians can be assigned to orders and service requests';
                    break;
                case 'AMC':
                    info.textContent = 'AMC customers get priority support and free service requests';
                    break;
            }
            
            this.parentNode.appendChild(info);
        }
    });
</script>
{% endblock %}